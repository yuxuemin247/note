[TOC]

# 单表查询

数据库相关设置

```python
''' 
# settings文件：
# Mysql连接配置
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'db_name',
        'HOST': '127.0.0.1',
        'USER': 'root',
        'PASSWORD': 'root'
    }
}
# 配置ORM的loggers日志
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'console': {
            'level': 'DEBUG',
            'class': 'logging.StreamHandler',
        },
    },
    'loggers': {
        'django.db.backends': {
            'handlers': ['console'],
            'propagate': True,
            'level': 'DEBUG',
        },
    }
}
'''
'''
# __init__文件:
import pymysql
pymysql.install_as_MySQLdb()

'''
'''
# models文件：
class User(models.Model):
    id = models.AutoField(primary_key=True)
    name = models.CharField(max_length=16)
    age = models.IntegerField()
    birthday = models.DateField()
'''
```

```python
'''
# test执行文件:
1. 加载项目配置文件
import os
os.environ.setdefault("DJANGO_SETTINGS_MODULE", "项目名.settings")
2. 启动Django
import django
django.setup()
3. 使用项目中的各个模块
# 直接导入django，可以查看并运用jdango包相关模块， 但无法使用用django创建的项目中的模块
'''
```

## 一、简单的增删改查

1、增

```python
'''
User.objects.create(name='Xxx', age=10, birthday='2008-08-08')

user = User(name='Zxx', age=8, birthday='2010-06-01')
user.save()
'''
```

2、查

```python
'''
# 操作的结果拥有是一个list
users = User.objects.filter(name='Xxx')

# 只能操作有且只有一条数据的记录
user = User.objects.get(id=1)
'''
```

3、改

```python
'''
User.objects.filter(name='Xxx').update(name='Xxx_best')

users = User.objects.filter(name='Xxx_best')
for user in users:
    user.name = 'Xxx'
    user.save()
'''
```

4、删

```python
'''
User.objects.filter(name='Xxx').delete()

user = User.objects.filter(name='Zxx').first()
user.delete()
'''
```

## 二、单表操作函数

```python
'''
1. all()：查询所有结果list，支持正向索引取值[i]，支持索引切片[m:n]
2. filter(**kwargs)：查询满足条件的所有结果list			  
3. get(**kwargs)：查询满足条件的唯一对象obj，查询结果不为obj则抛出异常		  
4. exclude(**kwargs)：查询满足条件的对立面的所有结果list
5. order_by(*field)：查询按照指定字段进行排序后的所有结果list，'tag_name'代表正序，'-tag_name'代表降序
6. reverse()：反转排序查询的所有结果list
7. count()：统计返回查询结果list的长度
8. first()：返回查询结果中的第一个对象obj
9. last()：返回查询结果中的最后一个对象obj
10. exists()：判断查询结果是否存在，值为布尔类型
11. values(*field)：按照指定字段(们)进行查询，返回存放包含字段(们)的字典的列表list
12. values_list(*field)：同values类似，返回存放数据的元组的列表list
13. distinct()：从查询结果中剔除重复字段(一般和values结合使用)
'''
```

## 三、模糊查询

```python
'''
user_list = User.objects.filter(id__gte=1)

# 整型相关
age__exact=8  # 确切匹配8
age__in=[8, 10]  # 8或10
age__gt=8  # 大于8
age__gte=8  # 大于等于8
age__lt=8  # 小于8
age__lte=8  # 小于等于8
age__range=[8, 10]  # 8到10之间
age__isnull=0|1  # 0：is not null | 1：is null

# 字符串相关
name__startswith  # 后方模糊匹配
name__endswith  # 前方模糊匹配
name__contains  # 前后方均模糊匹配
name__regex  # 正则匹配
name__istartswith  # 不区分大小写后方模糊匹配(i开头就是不区分大小写)

# 时间相关
birthday__year=2008  # 时间年份模糊匹配
'''
```

## 四、F 与 Q 查询

```python
'''
from django.db.models import F, Q
# F基于计算 F('字段名')
# 案例一：将id为1的结果年龄增加1
User.objects.filter(id=1).update(age=F('age')+1)
# 案例二：查询id是年龄1/4的结果
user = User.objects.filter(id=F('age')/4)

# Q基于关系 Q('字段条件')
# 与
User.objects.filter(Q(id=1) & Q(age=10))  # id=1 并且 age=10
# 或
User.objects.filter(Q(id=1) | Q(id=2))  # id=1 或 id=2
# 非
User.objects.filter(~Q(id=1))  # id 不为 1

'''
```

多表查询

```python
'''
图书管理系统

book表
id  name  price  publish_id  publish_date

publish表
id  name  address

author表
id  name  

author_detial表
id  age  sex  info  author_id

book_author表
id  book_id  author_id

'''
```





