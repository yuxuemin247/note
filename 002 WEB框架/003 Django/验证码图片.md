前端

```
<div>
 <img height="38px" class="valid-img" src="/customer/valid_Image/" alt="">
 </div>
 
 
 $(".valid-img").click(function () {
 this.src += '?';
 });
 
```

```
def valid_Image(request):
    from PIL import Image, ImageDraw, ImageFont
    from io import BytesIO
    import random
    # 获得随机颜色
    def get_random_color():
        return (random.randint(0, 255), random.randint(0, 255), random.randint(0, 255))
    # 生成背景图片
    img = Image.new('RGB', (130, 40), get_random_color())
    # 使用画笔
    draw = ImageDraw.Draw(img)
    # 设置验证码字体（字体文件与路径需自己设置）
    font = ImageFont.truetype('static/Hollywood Hills Italic.ttf', 20)
    # 创建存储验证码字符串的变量
    valid_text = ''
    # 生成验证码（包括数字与大小写字母）
    for i in range(5):
        random_Num = str(random.randint(0, 9))
        random_Lowchar = chr(random.randint(97, 122))
        random_Upchar = chr(random.randint(65, 90))
        random_text = random.choice([random_Num, random_Lowchar, random_Upchar])
        draw.text((i * 20 + 10, 5), random_text, get_random_color(), font)
        valid_text += random_text
    # 生成验证码图片内的干扰线与噪点
    width = 130
    height = 40
    for i in range(10):
        x1 = random.randint(0, width)
        y1 = random.randint(0, height)
        x2 = random.randint(0, width)
        y2 = random.randint(0, height)
        draw.line((x1, y1, x2, y2), fill=get_random_color())
    for i in range(120):
        x1 = random.randint(0, width)
        y1 = random.randint(0, height)
        draw.point((x1, y1), fill=get_random_color())
    # 设置session
    request.session['valid_text'] = valid_text
    # 将生成的图片存在内存中
    f = BytesIO()
    img.save(f, 'jpeg')
    data = f.getvalue()
    f.close()
    # 返回验证码图片
    return HttpResponse(data)
```

