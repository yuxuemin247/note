[TOC]

# 字段

## 一、常用共有字段属性

```python

1. null：默认为False，True表示字段可为null
2. blank：默认为False，True表示字段可为空
3. choice：可选的，限制了该选项的字段值必须是所指定的choice中的一个：
	-- sex = models.SmallIntegerField(choices=((1, '男'), (2, "女")))
	-- obj.get_sex_display()
4. db_column：自定义字段名
5. db_index：如果为True的话，设置索引
6. default：字段默认值
7. editable：默认为True，若为False，则不会在/admin/界面显示
8. primary_key：若设置为True，则表示将该字段设置为主键。一般情况下django默认会设置一个自增长的id主键。
9. unique：若设置为True，该字段值不可重复

```

## 二、常用字段

```python

1. AutoField()：默认自增主键(primary_key=True)，django会默认建立id字段主键
2. BooleanField()：布尔字段，对应数据库tinyint类型
3. CharField()：字符类型
	-- 字段属性max_length=64，数据长度，必须明确
4. DateField()：年月日时间类型
	-- 字段属性auto_now=True，数据被更新就会更新时间
	-- 字段属性auto_now_add=True，数据第一次参数时产生
5. DateTimeField()：年月日小时分钟秒时间类型
	-- 字段属性auto_now=True，数据被更新就会更新时间
	-- 字段属性auto_now_add=True，数据第一次参数时产生
6. DecimalField()：混合精度的小数类型
	-- 字段属性max_digits=3，限定数字的最大位数(包含小数位)
	-- 字段属性decimal_places=2，限制小数的最大位数
7. IntegerField()：整型

```

## 三、不常用字段

```python

1. BigAutoField()：大整型自增
2. BigIntegerField()：长整型
3. EmailField()：邮箱字段，拥有/admin/验证
4. FloatField()：浮点型小数
5. SmallIntegerField()：小整型
6. TextField()：大文本类型
7. FileField()：文件字段

```

## 四、关系字段

```python

1. ForeignKey()：外键字段
	-- 字段属性to关联模型类
	-- 字段属性to_field关联字段，省略默认关联主键
	-- 字段属性on_delete (外键关联数据被删除时的操作)
		-- models.CASCADE 级联删除
		-- modles.PROTECT 抛出异常
		-- models.SET_NULL 设置空值
		-- models.SET_DEFAULT 设置默认值
		-- models.SET(value)自定义值
	-- 字段属性related_name自定义反向查询的字段名
	-- 字段属性db_constraint=False取消关联关系，但还可以使用连表查询
总结：models.ForeignKey(to='关联的类名', null=True, on_delete=models.SET_NULL, db_constraint=False, related_name="本类名小写")
2、OneToOneField()：一对一外键字段
	-- 字段同外键
3、ManyToManyField()：多对多关系字段
	-- 字段属性to关联模型类
	-- 字段属性through关联关系类
	-- 字段属性through_fields关联关系表中(本身类名小写字段, 关联表类名小写字段)

```

## 五、断开外键关联的ForeignKey使用

```python

# 1、不使用ForeignKey方式断开关联，不再支持Django ORM连表查询语法
class Publish(models.Model):
    name = models.CharField(max_length=20)
class Book(models.Model):
    name = models.CharField(max_length=20)
    # 字段需要写_id来表示相关表的字段信息
    publish_id = models.IntegerField()

# *****
# 2、使用ForeignKey方式用db_constraint=False字段属性断开关联，依然支持Django ORM连表查询语法，建议使用
class Publish(models.Model):
    name = models.CharField(max_length=20)
class Book(models.Model):
    name = models.CharField(max_length=20)
    # 字段不需要写_id来表示相关表的字段信息，ORM会自动添加
    publish = models.ForeignKey(to='Publish', null=True, on_delete=models.SET_NULL, db_constraint=False)
```

## 六、断开关联的多对多自动创建关系表

```python

# *****
# 使用ManyToManyField方式用db_constraint=False字段属性断开关联，依然支持Django ORM连表查询语法，建议使用
class MyBook(models.Model):
    name = models.CharField(max_length=20)
    my_author = models.ManyToManyField(to='MyAuthor', db_constraint=False)
class MyAuthor(models.Model):
    name = models.CharField(max_length=20)

```

## 七、断开关联的多对多手动创建关系表

```python
# 手动创建关系表可以让关系表可以拥有更多的自身的字段，同时通过关系表类名可以直接获取第三张表

# ****
# 1、和自动建立关系表类似，依然支持Django ORM连表查询语法(多对多借助关系表连表查询)
class Book(models.Model):
    name = models.CharField(max_length=20)
    
class Author(models.Model):
    name = models.CharField(max_length=20)
    
class Book_Author(models.Model):
    book = models.ForeignKey(to="Book", null=True, on_delete=models.SET_NULL, db_constraint=False)
    author = models.ForeignKey(to='Author', null=True, on_delete=models.SET_NULL, db_constraint=False)
    time = models.DateField()



# ***
2、手动创建关系表，在关系表中用ForeignKey方式支持基于外键关系表的ORM连表查询，同时明确ManyToManyField字段，所以也支持ORM正向方向连表查询
	-- db_constraint=False断开关联可以在ForeignKey或ManyToManyField任意一方完成
class Book(models.Model):
    name = models.CharField(max_length=20)
    # 明确through与through_fields，ManyToManyField才不会自动建立关系表
    author = models.ManyToManyField(to='Author', through='Book_Author', through_fields=('book_id', 'author_id'))
    
class Author(models.Model):
    name = models.CharField(max_length=20)
    
class Book_Author(models.Model):
    book = models.ForeignKey(to="Book", null=True, on_delete=models.SET_NULL, db_constraint=False)
    author = models.ForeignKey(to='Author', null=True, on_delete=models.SET_NULL, db_constraint=False)
    time = models.DateField()

# 总结：手动创建第三张表，第三张表的增删改就采用关系表类名衍生的create|delete|update，就不再拥有add|clear|remove|set（因为关系表拥有自己的字段，这些方法无法直接操作这些字段）
```

