[TOC]

# Django的安装与配置

### 一、CMD：Django安装与项目的创建

```python
'''
安装：pip3 install django==1.11.x
查看版本号：django-admin --version
新建项目：1.前往目标目录  2.django-admin startproject proj_name

项目目录，包含项目最基本的一些配置
项目名：
   |--项目同名文件夹
	|---- __init__.py  模块的配置文件
	|---- settings.py  配置总文件
	|---- urls.py      url配置文件，主路由
	|---- wsgi.py      (web server gateway interface)，服务器网关接口，python应用与web服务器直接通信的接口
templates：模板文件夹，存放html文件的(页面)，支持使用Django模板语言(DTL)，也可以使用第三方(jinja2)
manage.py：项目管理器，与项目交互的命令行工具集的入口，查看支持的所有命令python3 manage.py
'''
```

### 二、app应用的创建

```python
'''
1.Django是面向应用开发，在应用中完成具体的业务逻辑
2.什么是应用app: 就好比项目中的一个功能模块，一个项目可以拥有多个功能模块，但至少得有一个，Django称之为app
3.如何创建app（在项目目录下）：python3 manage.py startapp app01

migrations：数据迁移(移植)模块，内容都是由Django自动生成
	-- __init__.py
__init__.py
admin.py：应用的后台管理系统配置
apps.py：django 1.9后，本应用的相关配置
models.py：数据模型模块，使用ORM框架，类似于MVC模式下的Model层
tests.py：自动化测试模块，可以写自动化测试脚本
views.py：执行相应的逻辑代码模块
'''
```

### 三、启动项目

```python
# 终端： python3 manage.py runserver 127.0.0.1:8801
python manage.py runserver            # 启动
python manage.py runserver 0.0.0.0:8080   #启动改变端口号和外部访问：
python manage.py  makemigrations  #生成迁移文件
python manage.py migrate		   #执行迁移，存到数据库
django-admin startapp xxx         #新建一个app 
```

### 四、pycharm创建启动项目

```python
'''
1.创建Django
2.选择项目目录（从项目目录开始，目录文件夹及子文件夹不要出现中文，保证电脑名字不能为中文）
3.配置默认模板语言，模板路径，app名
4.启动
'''
```

### 五、生命周期

```python
'''
1.浏览器发送请求
2.wsgi服务器接收到请求，将请求解析交给Django
3.Django中间件过滤请求信息，交给路由
4.路由完成业务逻辑的分发，到指定app下views中指定的视图函数
5.视图函数完成具体的业务逻辑，返回响应结果
6.将处理结果通过服务器返回给浏览器
'''
```

### 六、三件套

```python
from django.shortcuts import HttpResponse, render, redirect

def action1(request):
    return HttpResponse("基础信息")

def action2(request):
    return render(request, 'template_page.html', {k:v})
  #特点： 通过模板引擎去加载模板，将模板加载完成之后转成str类型，再将str交给HttpResponse， 最终返回的还是一个response对象
    
def action3(request):
    return redirect('/重定向的路由')
```

### 七、setting配置

```python
'''静态文件
1.在settings.py中配置
STATIC_URL = '/static/'  # 静态文件请求根路由
STATICFILES_DIRS = [
    os.path.join(BASE_DIR, 'static')   # 静态文件检索的文件夹
]
2.在项目根目录下创建static文件夹
3.静态文件就放在static根目录或子目录下
4.获取静态文件：/static/目标文件(可以包含static子文件夹路径)
'''
'''
语言和时区
LANGUAGE_CODE = 'zh-hans' 
TIME_ZONE = 'Asia/Shanghai'  #
USE_I18N = True   #internationalization  国际化 支持多语言
USE_L10N = True	  #本地化，比如农历
USE_TZ = True
'''
#修改： 配置文件：
ALLOWED_HOSTS = ['*']  #允许所有访问
ALLOWED_HOSTS = ['192,168,0.114','127.0.0.1']  #列表为了防止黑客入侵，只允许列表中的ip地址访问 
#表示此Django站点可以投放的主机/域名的字符串列表。这是防止HTTP主机头部攻击的安全措施
```

### 八、请求及数据

```python
'''
请求路径：
1.空着：默认向当前路径发送请求
2.http://127.0.0.1:8801/testAction/：向testAction路径发送请求
3./testAction/: 向testAction路径发送请求(推荐)

在视图函数中
请求方式：request.method
GET请求获取数据：request.GET.get('key', None)  # 当key不存在，用None替换
POST请求获取数据：request.POST.get('key', None)  # 当key不存在，用None替换
'''
```

GET请求的数据获取

```python
# app应用下 views.py 文件
def login(request):
    if request.method == "GET":
        # 获得到则返回一个值, 获取不到返回None
    	request.GET.get('usr')
        # 获得到则返回一个值, 获取不到返回默认值PWD
        request.GET.get('pwd', 'PWD')
        # 获得到则返回的多个值
        request.GET.getlist('stus')
```

POST请求的数据获取

```python
# app应用下 views.py 文件
def login(request):
    if request.method == "POST":
        # 获得到则返回一个值, 获取不到返回None
    	request.POST.get('usr')
        # 获得到则返回一个值, 获取不到返回默认值PWD
        request.POST.get('pwd', 'PWD')
        # 获得到则返回的多个值
        request.POST.getlist('stus')
```

### 九、配置Mysql完成数据迁移

```python
'''
1.在settings.py配置Mysql数据库信息
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'dg2',
        'HOST': '127.0.0.1',
        'USER': 'root',
        'PASSWORD': 'root'
    }
}

2.在项目或应用的init文件中修改连接数据库的模块为pymysql
import pymysql
pymysql.install_as_MySQLdb()

3.在项目目录下，执行(生成迁移数据，没有映射到数据库)：python3 manage.py makemigrations

4.将迁移数据映射到数据库：python3 manage.py migrate

'''
#官方django2.0推荐使用 mysqlclient
```

### 十、单表ORM记录的增删改查

```python
'''
# 增
User.objects.create(usr='abc', pwd='123')  # 第一种方式
user = User(usr='owen', pwd='123')
user.save()  # 第二种方式
# 删
User.objects.filter(id=1).delete()
# 改
User.objects.filter(pwd='123').update(pwd='000')
# 查
User.objects.filter(pwd='000').all()
User.objects.filter(pwd='000').first()
'''
```



