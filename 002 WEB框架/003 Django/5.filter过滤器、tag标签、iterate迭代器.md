[TOC]

# DTL -- Django模板语言

DTL简介

```python
'''
全称：Django模板语言(Django Template Language)
语法：
	filter {{ }}
	tag {% %}	
'''
```

## 一、变量

```python
'''
1.视图函数可以通过两种方式将变量传递给模板页面
	-- render(request, 'test_page.html', {'变量key1': '变量值1', ..., '变量keyn': '变量值n'})
	-- render(request, 'test_page.html', locals())
		>>> locals() 就是将视图函数中的所有变量都传递给模板页面

2.模板页面中对变量的使用
	-- 语法：{{ 变量 }}
	-- 支持("全")类型：数字、字符串、布尔、列表、元组、字典、函数、对象、类
	-- 注：list.0 | dic.key | obj.name | obj.fn 来查看内部成员数据
'''
```

## 二、过滤器 -- filter

```python
'''
1.语法：
	-- {{ 变量|过滤器1[:参数]|...|过滤器n[:参数]] }}
	-- 注：过滤器可以串联操作，可以拥有0个或1个参数
	
2.常见内置filter
	-- 增加   add:num
	-- 字符串长度   length
	-- 默认值   default:'默认值'  # 变量不存在或为空
	-- 全大写   upper
	-- 全小写   lower
	-- 切片   slice:'0:-1'
	-- 将数字转换为文件大小   filesizeformat
	-- 字符串隐藏   truncatechars:13   # 只显示10个字符，后置字符都用...来替代
	-- 时间   date:'Y-m-d'
	-- 转换原意   safe

'''
```

## 三、标签 -- tag

```python
'''
1.语法：
	-- {% 关键词 参数们 %}
2.内置tag
	-- 反向解析url   {% url 'namespace:url_name' arg1 arg2 %}
	-- 当前时间now   {% now 'Y-m-d' %}
	-- 起别名with   {% with '后面的别名flag就代表我' as flag %} {{ flag }} {% endwith %}
	-- Django CSRF认证   {% csrf_token %}
'''
```

## 四、条件分支tag

```python
'''
语法：
{% if 条件1 %}
    结论1
{% elif 条件2 %}
	结论2
{% else %}
    结论n
{% endif %}

注：
1. if的条件可以添加filter
2. 可以嵌套
'''
```

## 五、迭代器 -- iterate

```python
'''
{% for foo in iterate %}
    {{ forloop }}
{% empty %}
    可迭代对象为空
{% endfor %}

注：
1. iterate为可迭代对象
2. iterate可以添加filter
3. forloop变量为存放迭代信息的字典
4. empty分支会在可迭代对象为空时执行
'''
```

## 六、自定义过滤器filter与标签tag

```python
'''
步骤：
1. 在注册的app下创建templatetags包
2. 在模板中自定义模块py文件，如：owen_tags.py
3. 要在使用自定义filter与tag的模板页面中加载自定义模块py文件，案例：{% load owen_tags %}

4. 自定义filter语法
from django.template import Library
register = Library()
@register.filter(name='jump')
def owen_jump(value, arg):
	try:
        return value * int(arg)
    except (ValueError, TypeError):
        return ''
            
5. 自定义tag语法
@register.simple_tag(name='add_two')
def owen_add(arg1, arg2):
	try:
        return int(arg1) + int(arg2)
    except (ValueError, TypeError):
        try:
            return arg1 + arg2
        except Exception:
            return ''
            
6. 在加载了自定义模块py文件的模板页面中使用，案例：
{{ 10|jump:2}}  # 10 * 2
{% add_two 10 20 %}  # 10 + 20
'''
```

全系统过滤器（了解）

```python
{{ 123|add:"5" }} 给value加上一个数值
{{ "AB'CD"|addslashes }} 单引号加上转义号，一般用于输出到javascript中
{{ "abcd"|capfirst }} 第一个字母大写
{{ "abcd"|center:"50" }} 输出指定长度的字符串，并把值对中
{{ "123spam456spam789"|cut:"spam" }} 查找删除指定字符串
{{ value|date:"F j, Y" }} 格式化日期
{{ value|default:"(N/A)" }} 值不存在，使用指定值
{{ value|default_if_none:"(N/A)" }} 值是None，使用指定值
{{ 列表变量|dictsort:"数字" }} 排序从小到大
{{ 列表变量|dictsortreversed:"数字" }} 排序从大到小
{{ string|escape }} 转换为html实体
{{ 21984124|filesizeformat }} 以1024为基数，计算最大值，保留1位小数，增加可读性
{{ list|first }} 返回列表第一个元素
{{ "ik23hr&jqwh"|fix_ampersands }} &转为&
{{ 13.414121241|floatformat }} 保留1位小数，可为负数，几种形式
{{ 13.414121241|floatformat:"2" }} 保留2位小数
{{ 23456 |get_digit:"1" }} 从个位数开始截取指定位置的1个数字
{{ list|join:", " }} 用指定分隔符连接列表
{{ list|length }} 返回列表个数
{% if 列表|length_is:"3" %} 列表个数是否指定数值
{{ "ABCD"|linebreaks }} 用新行用
{{ "ABCD"|linebreaksbr }} 用新行用 标记包裹
{{ 变量|linenumbers }} 为变量中每一行加上行号
{{ "abcd"|ljust:"50" }} 把字符串在指定宽度中对左，其它用空格填充
{{ "ABCD"|lower }} 小写
{{ "abcdefghijklmnopqrstuvwxyz"|phone2numeric }} 把字符转为可以对应的数字？？
{{ 列表或数字|pluralize }} 单词的复数形式，如列表字符串个数大于1，返回s，否则返回空串
{{ 列表或数字|pluralize:"es" }} 指定es
{{ 列表或数字|pluralize:"y,ies" }} 指定ies替换为y
{{ object|pprint }} 显示一个对象的值
{{ 列表|random }} 返回列表的随机一项
{{ string|removetags:"br p div" }} 删除字符串中指定html标记
{{ string|rjust:"50" }} 把字符串在指定宽度中对右，其它用空格填充
{{ 列表|slice:":2" }} 切片
{{ string|slugify }} 字符串中留下减号和下划线，其它符号删除，空格用减号替换
{{ 3|stringformat:"02i" }} 字符串格式，使用Python的字符串格式语法
{{ "EABCD"|striptags }} 剥去[X]HTML语法标记
{{ 时间变量|time:"P" }} 日期的时间部分格式
{{ datetime|timesince }} 给定日期到现在过去了多少时间
{{ datetime|timesince:"other_datetime" }} 两日期间过去了多少时间
{{ datetime|timeuntil }} 给定日期到现在过去了多少时间，与上面的区别在于2日期的前后位置。
{{ datetime|timeuntil:"other_datetime" }} 两日期间过去了多少时间
{{ "abdsadf"|title }} 首字母大写
{{ "A B C D E F"|truncatewords:"3" }} 截取指定个数的单词
{{ "111221"|truncatewords_html:"2" }} 截取指定个数的html标记，并补完整
{{ list|unordered_list }} 多重嵌套列表展现为html的无序列表
{{ string|upper }} 全部大写
{{ string|urlize }} 将URLs由纯文本变为可点击的链接。（没有实验成功）
{{ string|urlizetrunc:"30" }} 同上，多个截取字符数。（同样没有实验成功）
{{ "B C D E F"|wordcount }} 单词数
{{ "a b c d e f g h i j k"|wordwrap:"5" }} 每指定数量的字符就插入回车符
{{ boolean|yesno:"Yes,No,Perhaps" }} 对三种值的返回字符串，对应是 非空,空,None
```

