# 邮件发送时间显示

## 一、邮件发送

扩展库：flask-mail

**概述：** 是一个邮件发送的扩展库  使用非常方便

**安装：**

pip install flask-mail

**配置发送邮件实例：**

````python

````

**发送邮件视图函数**

```python
@app.route('/send_mail/')
def send_mail():
    # 创建邮件对象
    msg = Message(subject='美女你学Python吗？',recipients=['793390457@qq.com'],sender=app.config['MAIL_USERNAME'])
    # 邮件主体内容
    # msg.html = '<h4>你好：目前Python这么火热 来加入我们吗?</h4>'
    msg.html = render_template('active.html',username='lucky')
    # 发送邮件
    mail.send(message=msg)
    return '发送邮件'
```

**模板代码active的内容**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h4>账户激活</h4>
<h5>你好：{{ username }} 您的账户就差最后一步 请点击右侧激活链接地址--- <a href="http://www.baidu.com" target="_blank">激活</a></h5>
</body>
</html>
```

**异步发送邮件**

```python
from flask import Flask,render_template
from flask_mail import Mail,Message
from flask_script import Manager
import os
# 导入线程类
from threading import Thread

app = Flask(__name__)
# 邮箱服务器
app.config['MAIL_SERVER'] = 'smtp.1000phone.com'
# 用户名
app.config['MAIL_USERNAME'] = 'xialigang@1000phone.com'
# 密码
app.config['MAIL_PASSWORD'] = os.environ.get('MAIL_PASSWORD')
# 创建邮件发送对象
mail = Mail(app)
manager = Manager(app)

# 异步执行耗时操作
def async_send_mail(msg):
    with app.app_context():
        mail.send(message=msg)


@app.route('/send_mail/')
def send_mail():
    # 创建邮件对象
    msg = Message(subject='美女你学Python吗？',recipients=['793390457@qq.com'],sender=app.config['MAIL_USERNAME'])
    # 邮件主体内容
    # msg.html = '<h4>你好：目前Python这么火热 来加入我们吗?</h4>'
    msg.html = render_template('active.html',username='lucky')
    # 发送邮件
    # 创建线程
    thr = Thread(target=async_send_mail,args=(msg,))
    # 启动线程
    thr.start()
    return '发送邮件'


@app.route('/test_template/')
def test_template():
    print(render_template('active.html',username='lucky'))
    return '测试渲染模板方法 render_template'


if __name__ == '__main__':
    manager.run()
```

**配置临时变量：**

Linux/unix

**设置**

export 名称=值

**获取**

echo $名称

windows

**设置：**

set 名称=值

**获取**

set  名称



----

## 二、时间显示

**扩展库：**

flask-moment

**安装：**

pip install flask-moment

**概述：**

专门负责时间本地显示的扩展库  使用非常的方便

**使用：**

manage.py	

```python
from flask import Flask,render_template
from flask_script import Manager
from flask_bootstrap import Bootstrap
# 导入时间显示的扩展库
from flask_moment import Moment
from datetime import datetime,timedelta


app = Flask(__name__)
app.config['BOOTSTRAP_SERVE_LOCAL'] = True
# 创建对象
moment = Moment(app)
Bootstrap(app)
manager = Manager(app)


@app.route('/moment/')
def test_moment():
    current_time = datetime.utcnow()+timedelta(seconds=-600)
    return render_template('test_moment.html',time=current_time)


if __name__ == '__main__':
    manager.run()
```

模板代码

```html
{% extends 'common/base.html' %}
{% block page_content %}
    <h4>测试时间显示的扩展库</h4>
    <p>{{ moment(time).format('L') }}</p>
    <p>{{ moment(time).format('LL') }}</p>
    <p>{{ moment(time).format('LLL') }}</p>
    <p>{{ moment(time).format('YYYY-MM-DD') }}</p>
    {#  距离多久发表的  #}
    <p>{{ moment(time).fromNow() }}</p>
{% endblock %}
{% block scripts %}
    {{ super() }}
    {{ moment.include_moment() }}
    {#  汉化  #}
    {{ moment.locale('zh-CN') }}
{% endblock %}
```

**官网地址：**

http://momentjs.com/docs/#/displaying/