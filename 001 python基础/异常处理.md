# 错误、异常

## 1. 异常处理

***错误***指的是代码有语法问题，无法解释运行，必须改正后才能运行

如果代码没有语法问题，可以运行，但会出运行时的错误，例如除零错误，下标越界等问题，这种在运行期间检测到的错误被称为***异常*** ，出现了异常必须处理否则程序会终止执行，用户体验会很差。`Phthon`支持程序员自己处理检测到的异常。可以使用try-except语句进行异常的检测和处理

```
如何排查错误

1.定位到错误发生的位置

查看追踪信息

	1.如果代码都是自己写的，没有调用任何内置模块或方法，那么错误发生位置一定在最后一行。

	2.如果你的代码调用其他模块的方法

		1.调用时出了错误。内置模块不可能出错

		2.别人写的模块有可能出错

如果有很多追踪信息，找最后一行是自己写代码的位置

2.查看异常类型	例如：IndexError

3.查看异常的值	例如：list index out if range
```

```
# 常见异常
- `AttributeError `试图访问一个对象没有的属性，比如foo.x，但是foo没有属性x
- `IOError `输入/输出异常；无法打开文件或无法读写
- `ImportError `无法引入模块或包；基本上是路径问题或名称错误
- `SyntaxError `Python语法错误异常，代码不能编译
- `IndentationError` 缩进异常；代码没有正确缩进
- `IndexError` 下标索引超出序列边界，比如当x只有三个元素，却试图访问x[5]
- `KeyError` 试图访问字典里不存在的键
- `KeyboardInterrupt`   Ctrl+C被按下
- `NameError` 使用一个还未被赋予对象的变量
- `TypeError` 传入对象类型与要求的不符合
- `UnboundLocalError` 试图访问一个还未被设置的局部变量，基本上是由于另有一个同名的全局变量，
  导致你以为正在访问它
- `ValueError `   值错误传入一个调用者不期望的值，即使值的类型是正确的
```

### 1.1 try-except语句

~~~
语法：
	try:
		【代码块A】 #可能会出错误的代码    异常检测
	except Exception1[ as e]:   #异常处理，先捕获能够明确的异常类型 最后捕获万能异常类型
	 【代码块1】  #异常处理代码       
    except Exception2[ as e]:   #异常处理
         【代码块2】  #异常处理代码
    ....
    except Exceptionn[ as e]:   #异常处理
      【代码块n】  #异常处理代码
	[else:]                #可选，如果没有发生异常时会执行
	    处理语句       
	[finally:]      #无论如何都要执行的语句，可以用finally来执行一些清理操作，类似 __del__
	    处理语句
   【后续语句】
~~~

- 执行流程：
  - 1、首先执行try中【代码块A】，如果出现异常，立即终止代码执行，转而到except块中进行异常处理
  - 2、异常处理except模块可以多个，从上往下匹配，如果能够匹配成功，立即执行相应的异常处理代码块，执行完毕后，不在往下匹配，转到3执行
  - 3、执行异常处理完毕后，如果有finally字句则执行finally字句，如果没有则执行【后续语句】
  - 4、如果匹配不到异常，有finally则执行finally，然后则抛出错误，终止程序执行。
  - 5、如果没有异常，如果有else字句则执行else字句，执行完else后，有finally字句则执行，没有则执行【后续语句】
- 注意事项：
  - except匹配顺序从上到下
  - except语句书写要求：精确的类型往前放，模糊的，不精确的往后放
  - except不带任何类型，则匹配所有类型异常，应该放到最后，吞掉异常
  - 可以将多种异常用元组的方式（异常类型1，异常类型2...异常类型n）书写，简化代码
  - except字句中e，是一个对象，打印它，会显示异常信息描述
  - try-except也可以捕获方法或函数中抛出的异常
  - 所有异常类型都继承自BaseException，使用BaseException可以将异常一网打尽
  - finally字句中可以进行一些清理工作，比如关闭文件，数据库等工作

### 1.3 抛出异常

手动抛出一个指定类型的异常，无论是哪种异常类都可以带一个字符串参数，对异常进行描述。

- raise不带参数会把错误原样抛出

~~~
try:
    raise ZeroDivisionError('除0错误')
    # raise ZeroDivisionError  #如果不想获取错误信息，可以不带参数
except ZeroDivisionError as e:
    print(e)  #除0错误
~~~

### 1.4 异常嵌套

在try块和excep块中还可以分别再嵌套try-except块

### 1.5 assert断言

​    语法：assert 条件 [,异常描述字符串]

​     执行流程：如果条件为假，则抛出AssertionError，条件为真，就当assert不存在

​    作用：对于可能出问题的代码，加上断言，方便问题排查

~~~
#其实就是断定，确定某个条件一定成立的
#有一段代码，要执行必须要保证某个条件是成立的
print('start')
num = int(input('请输入一个1~9的整数:'))
assert 0 <num <=9,'num不在1~9'
print('end')
~~~

### 1.6 自定义异常类

如果系统异常类型满足不了业务需求，那么可以自己定义异常类来处理。

- 自己定义的异常类必须继承BaseException或Exception
- 步骤：
  - 在自定义异常类的构造函数中，调用父类构造函数
  - 重写`__str__`方法输出异常信息
  - 编写异常处理方法处理异常

~~~
class CustomError(BaseException): #继承BaseException
    def __init__(self,msg):
        super().__init__()  #调用父类初始化
        self.msg = msg
        
    #重写__str__，输出异常信息
    def __str__(self):
        return self.msg
    
    #3.自定义异常处理方法
    def handle_exception(self):
        print('异常处理')
        
try:
    raise CustomError('自定义异常')
except CustomError as e:
    print(e)
~~~

## 2. 内建异常类层次

```
BaseException
 +-- SystemExit
 +-- KeyboardInterrupt
 +-- GeneratorExit
 +-- Exception     #万能异常，尽量少用，很有可能即不报错，也不正常运行，无法定位错误位置
      +-- StopIteration
      +-- StopAsyncIteration
      +-- ArithmeticError
      |    +-- FloatingPointError
      |    +-- OverflowError
      |    +-- ZeroDivisionError
      +-- AssertionError
      +-- AttributeError
      +-- BufferError
      +-- EOFError
      +-- ImportError
      +-- LookupError
      |    +-- IndexError
      |    +-- KeyError
      +-- MemoryError
      +-- NameError
      |    +-- UnboundLocalError
      +-- OSError
      |    +-- BlockingIOError
      |    +-- ChildProcessError
      |    +-- ConnectionError
      |    |    +-- BrokenPipeError
      |    |    +-- ConnectionAbortedError
      |    |    +-- ConnectionRefusedError
      |    |    +-- ConnectionResetError
      |    +-- FileExistsError
      |    +-- FileNotFoundError
      |    +-- InterruptedError
      |    +-- IsADirectoryError
      |    +-- NotADirectoryError
      |    +-- PermissionError
      |    +-- ProcessLookupError
      |    +-- TimeoutError
      +-- ReferenceError
      +-- RuntimeError
      |    +-- NotImplementedError
      |    +-- RecursionError
      +-- SyntaxError
      |    +-- IndentationError
      |         +-- TabError
      +-- SystemError
      +-- TypeError
      +-- ValueError
      |    +-- UnicodeError
      |         +-- UnicodeDecodeError
      |         +-- UnicodeEncodeError
      |         +-- UnicodeTranslateError
      +-- Warning
           +-- DeprecationWarning
           +-- PendingDeprecationWarning
           +-- RuntimeWarning
           +-- SyntaxWarning
           +-- UserWarning
           +-- FutureWarning
           +-- ImportWarning
           +-- UnicodeWarning
           +-- BytesWarning
           +-- ResourceWarning
```

