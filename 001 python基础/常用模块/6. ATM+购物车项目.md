[TOC]

# ATM+购物车

项目的生命周期

1.需求分析

2.项目设计

3.项目开发

4.项目测试

5.上线运行

6.维护更新

**项目设计的三层结构**

程序的本质就是在帮用户**处理数据**

1.用户通过某种方式将数据交给程序（app、浏览器、pc端程序）

2.程序在拿到数据之后进行分析 判断数据是否正确（python、c、java）

3.将正确数据进行存储（数据库 文件）



**三层结构：**

1.用户界面层				负责接收用户数据，或者展示数据给用户

2.业务逻辑层				负责处理用户界面层得到的数据，进行判断 验证

3.数据访问层（持久层）	负责帮助业务逻辑层 保存数据 或是读取数据



与程序处理数据的三步刚好是对应，界面层与数据层不应该直接通讯

分层的最终目的：高内聚、低耦合（相关的功能都聚集在一起，不相关的功能进行拆分（各模块间的影响降低））



**项目开发的三个文档：**

1.需求分析书

2.接口文档（前后台制定相同的标准 api）接口指的是后台提供前台用于完成某个功能的函数

3.原型图：美工画出来的图，前端程序员负责按照原型图，用代码实现



实例：

```python
额度 15000或自定义
实现购物商城，买东西加入 购物车，调用信用卡接口结账
可以提现，手续费5%
支持多账户登录
支持账户间转账
记录每月日常消费流水
提供还款接口
ATM记录操作日志 
提供管理接口，包括添加账户、用户额度，冻结账户等。。。
用户认证用装饰器
需求分析最重要的是,分析每个需求,对应的功能,以及是实现思路,是否可行,分析的最终结果是,将用户的需求转换为程序中的一个个可用功能

#包含的功能:

1.注册
2.购物功能   购买后加到购物车
3.查看购物车
4.结算
5.提现
6.登录
7.还款
8.转账
9.查看流水
10.管理员界面
    添加账户
    调整额度
    冻结账户
    解冻账户
    
#隐藏需求
1.加入购物车
2.记录消费流水
3.ATM的操作日志
4.用装饰器实现用户认证  比如你要转账的时候,先验证是否登录

#数据存储
数据存储使用json
```

默写:

start

```python
from core import src

if __name__ == '__main__':
    src.login()
```

src

```python
#该模块 用于负责与用户交互 接受数据或是 展示数据（属于用户视图层）
import json,os
from interface import ATM


#记录当前用户信息
current_user=None
def login():
    while True:
        name = input('请输入用户名(q退出):').strip()
        if name == 'q':
            return
        password = input('请输入密码:').strip()

        if not name or not password:
            print('用户名和密码不能为空！')
            continue

        #调用业务逻辑层处理数据 不仅要返回状态信息 详细信息 还需要返回用户数据
        # 因为在转帐，购物和其他功能中，需要使用用户信息
        status,msg,userdic = ATM.login(name,password)
        global current_user
        current_user = userdic     #记录用户信息
        print(msg)
        if status:
            return
```

db_handler

```python
#该模块负责 存取数据（属于数据访问层）
import os,json

def get_data(name):
    '''
    该功能用于读取用户数据
    :param name: 要读取的文件名称
    :return: 读取到的数据
    '''

    #拼接文件路径
    path=r'C:\Users\HASEE\Desktop\作业\day20\默写\ATM+购物车\db\userData\\'+name

    #先判断是这个数据文件是否存在
    if os.path.exists(path):
        #如果存在就打开这个文件并读取数据
        with open(path,'rt',encoding='utf-8') as f:
            data = json.load(f)
            return data
```

ATM

```python
'''
    该接口用于处理ATM相关的操作
    从界面获取数据进行 业务逻辑处理
    处理完后交给数据访问层进行读写
'''

import os,json

from db import db_handler

def login(name,password):
    #判断用户名和密码是否都匹配数据库(json文件)
    userdic = db_handler.get_data(name)
    if not userdic:
        return False,'用户名不存在',None

    #判断密码是否匹配
    if userdic['password'] == password:
        return True,'登陆成功',userdic
    return False,'密码错误！',None
```



# 整体框架

用户界面层：获取用户输入的数据，将数据交给业务逻辑层进行处理。将业务逻辑层传输的数据展示给用户

业务逻辑层：接收用户视图层的数据，对数据进行处理后交给数据访问层。将数据访问层传输的数据返回给用户层						

数据访问层：将业务逻辑层传过来的数据进行存储，将可读取数据传输给业务逻辑层



start 文件——》启动文件：设置环境变量，调用 core 中的 src 模块     启动函数 main_view() 



**core**：src 文件和 admin 文件 ，——》**用户界面层**：调用 interface (业务逻辑层)的 ATM 模块 和 shopping_center 模块(购物控制中心) 、调用 core 的 admin 模块(管理员控制)：对src中的函数进行控制

src中的admin 调用了interface中的admin：传输数据

调用 conf 的 loggin_config 模块(日志配置文件) ：对日志生成器进行配置

**加上装饰器和日志生成器，定义用户需求功能函数和调用功能函数**。



**interface**：ATM 文件、 shopping_center 文件和 admin 文件——》**业务逻辑层**：调用 db (数据访问层) 的 db_handler 模块

调用 datetime模块：记录日志

**在各个文件上定义与 core 中文件 对应的函数(参数)**：将传过来的参数进行处理，交给db_handler存储到db中，将要返回的数据让db_handler从db中读取



**db**：db_handler 文件——》**数据访问层**：调用 os，json 模块、调用 conf (配置文件夹) 的 settings 文件：获取存储的文件路径，以便对文件进行存储和读取。json模块：方便文件内容进行读写。

**就写存储函数和读取函数**



conf：loggin_config 文件、settings 文件 ——》配置文件夹：loggin_config:日志配置文件  调用os、调用conf 的settings：获取路径 ，方便日志设置

settings：路径设置文件	调用os，设置路径



log：ATM.log——》日志文件夹：ATM.log:日志文件，记录日志。